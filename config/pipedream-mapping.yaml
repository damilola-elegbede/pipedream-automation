# Pipedream Workflow Deployment Configuration
# Maps local Python scripts to Pipedream workflow steps
#
# Environment Variables Required:
#   PIPEDREAM_WORKFLOW_GMAIL_TO_NOTION     - Workflow ID for Gmail to Notion
#   PIPEDREAM_WORKFLOW_NOTION_TASK_TO_GCAL - Workflow ID for Notion Task to GCal
#   PIPEDREAM_WORKFLOW_NOTION_UPDATE_TO_GCAL - Workflow ID for Notion Update to GCal
#   PIPEDREAM_WORKFLOW_GCAL_TO_NOTION      - Workflow ID for GCal to Notion
#
# Usage:
#   python -m src.deploy.deploy_to_pipedream --config config/pipedream-mapping.yaml
#   python -m src.deploy.deploy_to_pipedream --workflow gmail_to_notion --dry-run

version: "1.0"

# Base URL for Pipedream
pipedream_base_url: "https://pipedream.com"

# Pipedream account settings (read from environment)
pipedream_username: "${PIPEDREAM_USERNAME}"
pipedream_project_id: "${PIPEDREAM_PROJECT_ID}"

# Workflows to update
# Workflow IDs are read from environment variables
workflows:
  # Gmail to Notion Workflow (3 steps)
  gmail_to_notion:
    id: "${PIPEDREAM_WORKFLOW_GMAIL_TO_NOTION}"
    name: "Gmail to Notion Task Creator"
    steps:
      - step_name: "fetch_gmail_emails"
        script_path: "src/steps/fetch_gmail_emails.py"
        description: "Fetches emails from Gmail with label filters"
      - step_name: "create_notion_task"
        script_path: "src/steps/create_notion_task.py"
        description: "Creates Notion tasks from email data"
      - step_name: "label_gmail_processed"
        script_path: "src/steps/label_gmail_processed.py"
        description: "Labels processed emails in Gmail"

  # Notion Task to Google Task Workflow
  notion_task_to_gcal:
    id: "${PIPEDREAM_WORKFLOW_NOTION_TASK_TO_GCAL}"
    name: "Create Google Task from Notion"
    steps:
      - step_name: "notion_task_to_google_tasks"
        script_path: "src/steps/notion_task_to_google.py"
        description: "Creates Google Task from Notion task"

  # Notion Update to Google Task Workflow
  notion_update_to_gcal:
    id: "${PIPEDREAM_WORKFLOW_NOTION_UPDATE_TO_GCAL}"
    name: "Update Google Task from Notion"
    steps:
      - step_name: "notion_update_to_google_tasks"
        script_path: "src/steps/notion_update_to_google.py"
        description: "Updates Google Task from Notion changes"

  # Google Task to Notion Sync Workflow
  gcal_to_notion:
    id: "${PIPEDREAM_WORKFLOW_GCAL_TO_NOTION}"
    name: "Update Notion Task from Google Task"
    steps:
      - step_name: "google_task_to_notion"
        script_path: "src/steps/google_to_notion.py"
        description: "Syncs Google Task changes to Notion"

# Deployment settings
settings:
  # Timeout for each step update (seconds)
  step_timeout: 60

  # Retry configuration
  max_retries: 3
  retry_delay_seconds: 5

  # Wait for autosave after code change (seconds)
  autosave_wait: 3

  # Run in headless mode (true for CI, false for debugging)
  headless: false

  # Screenshot configuration
  screenshot_on_failure: true
  screenshot_path: ".tmp/screenshots"

  # Viewport size for browser
  viewport:
    width: 1920
    height: 1080
